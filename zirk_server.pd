#N canvas 554 111 358 246 10;
#X declare -path . -path ../externals;
#N canvas 781 75 345 172 inputs 0;
#X obj 33 78 r \$0-input;
#X text 27 18 Hardware input channels;
#X text 27 38 Audio signal sent to receive~ name "zirk_inputID";
#X obj 33 108 clone -s 1 zirk_input \$1;
#X connect 0 0 3 0;
#X restore 39 110 pd inputs;
#N canvas 574 235 433 279 declare 0;
#X text 23 15 add local paths so included externals will load;
#X obj 30 49 declare -path . -path ../externals;
#X obj 30 142 pdcontrol;
#X msg 30 115 args;
#X obj 30 212 print zirk_server;
#X obj 30 89 loadbang;
#X text 96 87 creation arg confirmation;
#X msg 30 171 \$1 inputs \, \$2 outputs \, \$3 ids \, \$4 sourcefiles
\, \$5 channels per sourcefile;
#X connect 2 0 7 0;
#X connect 3 0 2 0;
#X connect 5 0 3 0;
#X connect 7 0 4 0;
#X restore 194 42 pd declare;
#N canvas 567 204 390 185 sourcefiles 0;
#X obj 79 96 r \$0-sourcefile;
#X text 21 18 Source file players;
#X obj 79 130 clone -s 1 zirk_sourcefile\$5 \$4;
#X text 21 39 You can play up to \$4 files at the same time. Per-channel
audio signals to receive~ name: "zirk_sfID-CHANNEL";
#X connect 0 0 2 0;
#X restore 104 110 pd sourcefiles;
#X text 202 156 virtual speaker layer;
#X text 202 179 hardware output layer;
#N canvas 826 237 428 339 ids 0;
#X obj 251 219 list prepend level id;
#X obj 32 93 r \$0-id;
#N canvas 346 373 536 254 test 0;
#X obj 67 117 noise~;
#X obj 42 178 *~ 0.1;
#X obj 148 58 inlet;
#X obj 280 205 outlet;
#X text 22 12 Test white noise \, id 0;
#X msg 280 177 0 \$1;
#X obj 253 58 loadbang;
#X obj 42 85 lib/pinknoise~;
#N canvas 397 140 428 426 demux~ 0;
#X obj 108 67 inlet~;
#X obj 178 67 inlet~;
#X obj 258 66 inlet;
#X obj 108 373 outlet~;
#X obj 108 309 *~ 1;
#X obj 178 314 *~ 0;
#X msg 258 122 1 0;
#X msg 286 151 0 1;
#X obj 258 90 select 0 1;
#X obj 258 275 unpack 0 0;
#X connect 0 0 4 0;
#X connect 1 0 5 0;
#X connect 2 0 8 0;
#X connect 4 0 3 0;
#X connect 5 0 3 0;
#X connect 6 0 9 0;
#X connect 7 0 9 0;
#X connect 8 0 6 0;
#X connect 8 1 7 0;
#X connect 9 0 4 1;
#X connect 9 1 5 1;
#X restore 42 148 pd demux~;
#X obj 148 85 route noise;
#X obj 211 150 zirk_id 0 \$2;
#X obj 253 85 f \$0;
#X msg 323 58 bang;
#X obj 42 206 zirk_source 0test-\$0;
#X msg 253 116 input zirk_source0test-\$1 \, report current 1;
#X connect 0 0 8 1;
#X connect 1 0 13 0;
#X connect 2 0 9 0;
#X connect 5 0 3 0;
#X connect 6 0 11 0;
#X connect 7 0 8 0;
#X connect 8 0 1 0;
#X connect 9 0 8 2;
#X connect 9 1 10 0;
#X connect 10 1 5 0;
#X connect 11 0 14 0;
#X connect 12 0 11 0;
#X connect 14 0 10 0;
#X restore 32 180 pd test id 0;
#X obj 32 267 list trim;
#X obj 32 120 route 0;
#X obj 71 152 route all;
#X text 31 47 Receives audio signal from a receive~ name and sends
to zirk_speakers. zirk_id 0 is a test white noise source.;
#X obj 32 219 list prepend vbap current;
#X text 31 17 Sound object \, maps & spatializes inputs to outputs
;
#X obj 251 180 clone -s 1 zirk_id \$3 \$2;
#X obj 32 295 outlet;
#X connect 0 0 3 0;
#X connect 1 0 4 0;
#X connect 2 0 7 0;
#X connect 3 0 10 0;
#X connect 4 0 2 0;
#X connect 4 1 5 0;
#X connect 4 1 9 0;
#X connect 5 0 2 0;
#X connect 7 0 3 0;
#X connect 9 0 0 0;
#X connect 9 1 7 0;
#X restore 39 133 pd ids;
#N canvas 424 327 394 278 speakers 0;
#X obj 123 173 list prepend level speaker;
#X obj 123 121 r \$0-speaker;
#X obj 123 201 list trim;
#X text 15 8 Virtual speakers;
#X text 15 52 The connection of speaker and hardware output channels
can be configurable \, thus the speaker IDs are NOT hardware out channels.
;
#X text 15 30 Audio signals are received by catch~ name: "zirk_speakerID"
;
#X obj 123 147 clone -s 1 zirk_speaker \$2;
#X obj 123 230 outlet;
#X connect 0 0 2 0;
#X connect 1 0 6 0;
#X connect 2 0 7 0;
#X connect 6 0 0 0;
#X restore 59 156 pd speakers;
#N canvas 757 320 390 165 outputs 0;
#X obj 42 71 r \$0-output;
#X text 26 16 Hardware output channels;
#X text 26 38 Audio signal received by catch~ name "zirk_outputID"
;
#X obj 42 123 clone -s 1 zirk_output \$2;
#X connect 0 0 3 0;
#X restore 75 179 pd outputs;
#X text 202 110 input & source layer;
#N canvas 720 159 323 250 hrtf 0;
#X obj 102 121 zirk_output_hrtf;
#X obj 102 95 route all;
#X obj 102 68 r \$0-output;
#X text 32 13 Stereo HRTF channel receivers: dac~ 1 2;
#X obj 34 68 r \$0-hrtf;
#X obj 102 181 list trim;
#X obj 102 153 list prepend level hrtf;
#X obj 102 208 outlet;
#X connect 0 0 6 0;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 4 0 0 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X restore 146 179 pd hrtf;
#N canvas 521 428 485 272 commands 1;
#X obj 27 28 inlet;
#N canvas 267 73 366 342 layers 0;
#X obj 32 31 inlet;
#X obj 32 59 route input sourcefile id speaker output hrtf;
#X obj 76 250 s \$0-sourcefile;
#N canvas 0 25 360 238 hrtf 0;
#X obj 39 31 inlet;
#X obj 39 169 list trim;
#X obj 39 197 s \$0-id;
#X obj 39 141 list prepend all hrtf;
#X obj 84 84 s \$0-hrtf;
#X obj 39 60 route on;
#X obj 39 109 list prepend on;
#X text 118 171 forward on bool to ids;
#X connect 0 0 5 0;
#X connect 1 0 2 0;
#X connect 3 0 1 0;
#X connect 5 0 6 0;
#X connect 5 1 4 0;
#X connect 6 0 3 0;
#X restore 254 109 pd hrtf;
#X obj 299 84 outlet;
#X obj 32 287 s \$0-input;
#X obj 210 145 s \$0-output;
#X obj 121 219 s \$0-id;
#X obj 165 187 s \$0-speaker;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 1 1 2 0;
#X connect 1 2 7 0;
#X connect 1 3 8 0;
#X connect 1 4 6 0;
#X connect 1 5 3 0;
#X connect 1 6 4 0;
#X restore 27 83 pd layers;
#X obj 157 174 s \$0-layout;
#X obj 92 202 s \$0-samplerate;
#X obj 27 234 s \$0-transport;
#X text 83 28 command routing;
#X obj 27 115 route transport samplerate layout;
#X obj 222 144 print zirk_server: unknown command;
#X obj 27 55 list trim;
#X connect 0 0 8 0;
#X connect 1 0 6 0;
#X connect 6 0 4 0;
#X connect 6 1 3 0;
#X connect 6 2 2 0;
#X connect 6 3 7 0;
#X connect 8 0 1 0;
#X restore 29 43 pd commands;
#X text 202 133 id (sound object) layer;
#N canvas 521 162 443 405 speaker 0;
#X obj 43 191 zirk_layout_vbap;
#X obj 136 253 list trim;
#X obj 43 333 list trim;
#X obj 43 362 s \$0-id;
#X obj 43 305 list prepend all vbap;
#X obj 290 191 zirk_layout_hoa;
#X obj 43 150 t l l;
#X obj 290 305 list prepend all hoa;
#X obj 43 84 r \$0-layout;
#N canvas 674 82 711 629 transform 0;
#X obj 196 27 inlet;
#X obj 85 586 outlet;
#X obj 439 275 until;
#X obj 439 304 list append;
#X obj 531 287 bang;
#X obj 439 330 list split 2;
#X obj 439 355 unpack 0 0;
#X obj 439 448 pack 0 0;
#X obj 422 513 list append;
#X obj 534 495 t l;
#X obj 439 474 list prepend;
#X obj 422 235 t b b l b;
#X obj 127 275 until;
#X obj 127 304 list append;
#X obj 212 287 bang;
#X obj 110 513 list append;
#X obj 214 495 t l;
#X obj 127 474 list prepend;
#X obj 110 240 t b b l b;
#X obj 127 330 list split 1;
#X obj 439 379 * -1;
#X obj 439 400 + 90;
#X obj 127 379 * -1;
#X obj 127 400 + 90;
#X obj 110 175 route 2 3;
#X obj 422 546 list prepend 3;
#X obj 110 546 list prepend 2;
#X obj 127 426 lib/circlewrap;
#X obj 439 426 lib/circlewrap;
#X obj 85 145 route 0 1;
#X obj 196 60 route transform rotate flip;
#X obj 249 351 t f f;
#X obj 302 324 t f f;
#X text 262 22 transform: optionally rotate azimuth in degrees and/or
flip vertically, f 36;
#X text 492 236 3D;
#X text 176 240 2D;
#X obj 302 266 sel 0 1;
#X msg 302 293 1;
#X msg 338 293 - 1;
#X text 393 61 default: transform 0 \, rotate 90 \, flip 1;
#X obj 421 207 print zirkonium_server: unknown layout;
#X obj 85 111 list prepend 0;
#X connect 0 0 30 0;
#X connect 2 0 3 0;
#X connect 3 0 5 0;
#X connect 4 0 2 1;
#X connect 5 0 6 0;
#X connect 5 1 3 1;
#X connect 5 2 4 0;
#X connect 6 0 20 0;
#X connect 6 1 7 1;
#X connect 7 0 10 0;
#X connect 8 0 25 0;
#X connect 9 0 10 1;
#X connect 10 0 9 0;
#X connect 10 0 8 1;
#X connect 11 0 8 0;
#X connect 11 1 2 0;
#X connect 11 2 3 1;
#X connect 11 3 10 1;
#X connect 12 0 13 0;
#X connect 13 0 19 0;
#X connect 14 0 12 1;
#X connect 15 0 26 0;
#X connect 16 0 17 1;
#X connect 17 0 16 0;
#X connect 17 0 15 1;
#X connect 18 0 15 0;
#X connect 18 1 12 0;
#X connect 18 2 13 1;
#X connect 18 3 17 1;
#X connect 19 0 22 0;
#X connect 19 1 13 1;
#X connect 19 2 14 0;
#X connect 20 0 21 0;
#X connect 21 0 28 0;
#X connect 22 0 23 0;
#X connect 23 0 27 0;
#X connect 24 0 18 0;
#X connect 24 1 11 0;
#X connect 24 2 40 0;
#X connect 25 0 1 0;
#X connect 26 0 1 0;
#X connect 27 0 17 0;
#X connect 28 0 7 0;
#X connect 29 0 1 0;
#X connect 29 1 24 0;
#X connect 29 2 40 0;
#X connect 30 0 41 1;
#X connect 30 1 31 0;
#X connect 30 2 36 0;
#X connect 30 3 41 0;
#X connect 31 0 23 1;
#X connect 31 1 21 1;
#X connect 32 0 22 1;
#X connect 32 1 20 1;
#X connect 36 0 37 0;
#X connect 36 1 38 0;
#X connect 37 0 32 0;
#X connect 38 0 32 0;
#X connect 41 0 29 0;
#X restore 43 120 pd transform;
#X text 24 14 Speaker layout handling;
#X text 127 120 <- rotate and/or flip around origin?;
#X obj 136 224 list prepend vbap set;
#X text 24 38 Converts polar (azimuth & elevation) positions to format
required by the spatialization algorithms.;
#X obj 136 280 outlet;
#X connect 0 0 4 0;
#X connect 0 1 12 0;
#X connect 1 0 14 0;
#X connect 2 0 3 0;
#X connect 4 0 2 0;
#X connect 5 0 7 0;
#X connect 6 0 0 0;
#X connect 6 1 5 0;
#X connect 7 0 2 0;
#X connect 8 0 9 0;
#X connect 9 0 6 0;
#X connect 12 0 1 0;
#X restore 29 70 pd speaker layout;
#N canvas 131 236 409 242 transport 0;
#X obj 93 180 s #zirk-out;
#X obj 93 87 r \$0-transport;
#X obj 93 150 zirk_transport;
#X text 16 13 Time transport;
#X text 19 36 Calculates elapsed time using audio block size & samplerate
;
#X obj 210 88 r \$0-samplerate;
#X msg 210 113 samplerate \$1;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X connect 5 0 6 0;
#X connect 6 0 2 0;
#X restore 194 70 pd transport;
#X text 108 10 Zirkonium ZKM | Hertz-Labor 2015-2021;
#X obj 29 12 inlet;
#X obj 29 215 outlet;
#X connect 5 0 16 0;
#X connect 6 0 16 0;
#X connect 9 0 16 0;
#X connect 12 0 16 0;
#X connect 15 0 10 0;
